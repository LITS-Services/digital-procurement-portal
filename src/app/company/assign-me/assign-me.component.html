<div class="modal-header">
    <h4 class="modal-title text-white">Assign to Me - {{ entity }}</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="closeDialog()"  >
    </button>
</div>

<div class="modal-body">

    <!-- Already Assigned Message -->
    <div *ngIf="isAssigned && !showRemarks" class="alert">
        <strong>Already Assigned!</strong><br>
        This company is already assigned to:
        <b>{{ assignedUserName }}</b>
        <br><br>
        Do you still want to assign it to yourself?

        <div class="mt-2">
            <button class="btn btn-sm btn-danger mr-2" (click)="yesProceed()">Yes</button>
            <button class="btn btn-sm btn-secondary" (click)="closeDialog()">No</button>
        </div>
    </div>

    <form [formGroup]="assignMeForm" (ngSubmit)="submitForm()">

        <!-- Remarks Section -->
        <div *ngIf="showRemarks">
            <div class="col-lg-12 mb-2">
                <label>Remarks <span class="text-danger">*</span></label>
                <textarea 
                    class="form-control custom-input"
                    formControlName="remarks"
                    placeholder="Enter remarks..."
                    rows="4"
                    required>
                </textarea>

                <div *ngIf="assignMeForm.get('remarks')?.invalid && assignMeForm.get('remarks')?.touched"
                     class="text-danger small mt-1">
                    Remarks are required
                </div>
            </div>

            <!-- Error -->
            <div *ngIf="errorMessage" class="alert alert-danger">
                {{ errorMessage }}
            </div>

            <!-- Assign Button -->
            <div class="col-lg-12 mt-2">
                <button 
                    type="submit"
                    class="btn btn-primary"
                    [disabled]="assignMeForm.invalid || loading">
                    {{ loading ? 'Assigning...' : 'Assign to Me' }}
                    <span *ngIf="loading" class="spinner-border spinner-border-sm ml-2"></span>
                </button>
            </div>
        </div>

    </form>
</div>

<div class="modal-footer">
    <button class="btn btn-secondary" (click)="closeDialog()" [disabled]="loading">Close</button>
</div>
