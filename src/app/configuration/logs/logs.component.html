<div class="row mb-3">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center">
      <ul class="nav nav-tabs custom-tabs">
        <li class="nav-item">
          <a class="nav-link" [class.active]="selectedTab === 'exception'" (click)="selectTab('exception')">
            Exception Logs <!-- Keep original name -->
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="selectedTab === 'audit-trails'" (click)="selectTab('audit-trails')">
            Audit Trails
          </a>
        </li>
      </ul>
      
      <button type="button" class="btn btn-sm cstm-ui-table-btn mr-2" (click)="toggleFilterBar()">
        <i class="ft-sliders"></i><label class="ml-1 mt-1">Filter</label>
      </button>
    </div>
  </div>
</div>

<!-- FilterBar -->
<div *ngIf="showFilterBar" class="filter-bar">
  <div class="d-flex align-items-center justify-content-between pl-3 pr-1 py-2 filter-wrapper">
    <div class="filter-search">
      <i class="ft-filter search-icon"></i>
      <input style="padding-left: 3.4em;" type="text" class="form-control border-left-0 cstm-ui-input"
        placeholder="{{ selectedTab === 'exception' ? 'Search by Exception Type, Message...' : 'Search by Username, Table Name...' }}" 
        [formControl]="searchForm.get('searchTerm')" />
    </div>

    <div class="d-flex filter-btns-div">
      <div class="dropdown filter-dropdown" ngbDropdown>
        <button class="btn btn-sm filter-btn dropdown-toggle" type="button" ngbDropdownToggle>
          <span class="filter-label">{{ !statusTouched ? getFilterLabel() : selectedStatusLabel }}</span>
          <i class="ft-chevron-down"></i>
        </button>
        <div class="dropdown-menu" ngbDropdownMenu>
          <button class="dropdown-item" (click)="filterByStatus('All')">All</button>
          <ng-container *ngIf="selectedTab === 'audit-trails'">
            <button class="dropdown-item" (click)="filterByStatus('UPDATE')">UPDATE</button>
            <button class="dropdown-item" (click)="filterByStatus('INSERT')">INSERT</button>
            <button class="dropdown-item" (click)="filterByStatus('DELETE')">DELETE</button>
          </ng-container>
          <ng-container *ngIf="selectedTab === 'exception'">
            <button class="dropdown-item" (click)="filterByStatus('GET')">GET</button>
            <button class="dropdown-item" (click)="filterByStatus('POST')">POST</button>
            <button class="dropdown-item" (click)="filterByStatus('PUT')">PUT</button>
            <button class="dropdown-item" (click)="filterByStatus('DELETE')">DELETE</button>
            <button class="dropdown-item" (click)="filterByStatus('PATCH')">PATCH</button>
          </ng-container>
        </div>
      </div>

      <button class="btn px-1 btn-sm" (click)="showFilterBar = false">âœ•</button>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <!-- Exception Logs Table - Keep original columns -->
    <ngx-datatable autoResize *ngIf="selectedTab === 'exception'" class="bootstrap core-bootstrap" [rows]="logsData"
      [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'" [limit]="pageSize"
      [count]="totalItems" [externalPaging]="true" [offset]="currentPage - 1" (page)="onPageChange($event)"
      [scrollbarH]="true" [loadingIndicator]="loading" [selected]="chkBoxSelected"
      [selectionType]="SelectionType.single" (rowClick)="onRowClick($event)" (activate)="onActivate($event)"
      (clickType)="'single'"
      appPermission [appPermFormId]="FORM_IDS.LOGS"
      [appPermDisable]="'write'">

      <!-- Sr. No -->
      <ngx-datatable-column name="Sr. No." [width]="50" [resizeable]="false">
        <ng-template let-rowIndex="rowIndex" ngx-datatable-cell-template>
          <span>{{ ((currentPage - 1) * pageSize) + rowIndex + 1 }}</span>
        </ng-template>
      </ngx-datatable-column>

      <!-- <ngx-datatable-column name="TimeStamp" prop="timestamp"></ngx-datatable-column> -->
      <ngx-datatable-column name="TimeStamp" prop="timestamp">
        <ng-template ngx-datatable-cell-template let-row="row">
          {{ row.timestamp | date:'dd-MM-yyyy HH:mm a' }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Exception Type" prop="exceptionType"></ngx-datatable-column>
      <ngx-datatable-column name="Message" prop="message">
        <ng-template ngx-datatable-cell-template let-value="value">
          {{ value && value.length > 15 ? value.slice(0, 15) + '...' : value }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Http Method" prop="httpMethod"></ngx-datatable-column>
      <ngx-datatable-column name="Body" prop="body">
        <ng-template ngx-datatable-cell-template let-value="value">
          {{ value && value.length > 15 ? value.slice(0, 15) + '...' : value }}
        </ng-template>
      </ngx-datatable-column>
    </ngx-datatable>

    <!-- Audit Trails Table - Keep original columns -->
    <ngx-datatable autoResize *ngIf="selectedTab === 'audit-trails'" class="bootstrap core-bootstrap" [rows]="logsData"
      [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="'auto'" [limit]="pageSize"
      [count]="totalItems" [externalPaging]="true" [offset]="currentPage - 1" (page)="onPageChange($event)"
      [scrollbarH]="true" [loadingIndicator]="loading" [selected]="chkBoxSelected"
      [selectionType]="SelectionType.single" (rowClick)="onRowClick($event)" (activate)="onActivate($event)"
      (clickType)="'single'"
      appPermission [appPermFormId]="FORM_IDS.LOGS"
      [appPermDisable]="'write'">

      <!-- Sr. No -->
      <ngx-datatable-column name="Sr. No." [width]="50" [resizeable]="false">
        <ng-template let-rowIndex="rowIndex" ngx-datatable-cell-template>
          <span>{{ ((currentPage - 1) * pageSize) + rowIndex + 1 }}</span>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="Table Name" prop="tableName"></ngx-datatable-column>
      <ngx-datatable-column name="Action Type" prop="actionType"></ngx-datatable-column>
      <!-- <ngx-datatable-column name="TimeStamp" prop="timestamp"></ngx-datatable-column> -->
       <ngx-datatable-column name="TimeStamp" prop="timestamp">
        <ng-template ngx-datatable-cell-template let-row="row">
          {{ row.timestamp | date:'dd-MM-yyyy HH:mm a' }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Username" prop="username"></ngx-datatable-column>
      <ngx-datatable-column name="Changes" prop="changes">
        <ng-template ngx-datatable-cell-template let-value="value">
          {{ value && value.length > 15 ? value.slice(0, 15) + '...' : value }}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Is Entity Deleted" prop="isEntityDeleted"></ngx-datatable-column>
    </ngx-datatable>
  </div>
</div>

<!-- Modal template - Keep original structure -->
<ng-template #logDetailModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">
      {{ selectedTab === 'exception' ? 'Exception Log Details' : 'Audit Trail Details' }}
    </h5>
    <button type="button" class="close text-white" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <form *ngIf="selectedLog">
      <!-- Common fields -->
      <!-- <div class="mb-2">
        <label class="form-label">Timestamp</label>
        <input type="text" class="form-control" [value]="selectedLog.timestamp" disabled />
      </div> -->

      <div class="mb-2">
        <label class="form-label">Timestamp</label>
        <input type="text" class="form-control" [value]="selectedLog?.timestamp | date:'dd-MM-yyyy HH:mm a'" disabled />
      </div>

      <!-- Exception Log Fields - Keep original structure -->
      <ng-container *ngIf="selectedTab === 'exception'">
        <div class="mb-2">
          <label class="form-label">Http Method</label>
          <input type="text" class="form-control" [value]="selectedLog.httpMethod" disabled />
        </div>
        <div class="mb-2">
          <label class="form-label">Exception Type</label>
          <input type="text" class="form-control" [value]="selectedLog.exceptionType" disabled />
        </div>
        <div class="mb-2">
          <label class="form-label">Message</label>
          <textarea class="form-control" rows="3" [value]="selectedLog.message" disabled></textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Body</label>
          <textarea class="form-control" rows="3" [value]="selectedLog.body" disabled></textarea>
        </div>
      </ng-container>

      <!-- Audit Trail Fields - Keep original structure -->
      <ng-container *ngIf="selectedTab === 'audit-trails'">
        <div class="mb-2">
          <label class="form-label">Table Name</label>
          <input type="text" class="form-control" [value]="selectedLog.tableName"disabled />
        </div>
        <div class="mb-2">
          <label class="form-label">Action Type</label>
          <input type="text" class="form-control" [value]="selectedLog.actionType"disabled />
        </div>
        <div class="mb-2">
          <label class="form-label">Username</label>
          <input type="text" class="form-control" [value]="selectedLog.username" disabled />
        </div>
        <div class="mb-2">
          <label class="form-label">Changes</label>
          <textarea type="text" class="form-control" rows="3" [value]="selectedLog.changes" disabled></textarea>
        </div>
      </ng-container>
    </form>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close()">Close</button>
  </div>
</ng-template>